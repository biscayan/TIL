# Chapter 8. 데이터베이스 설계

## 데이터베이스 설계 단계
1. 요구사항 분석
    - 조직의 구성원들이 데이터베이스를 사용하는 용도를 파악
    - 데이터베이스를 사용해 실제 업무를 처리하는 사용자에게서 필요한 데이터의 종류와 처리 방법 같은 다양한 요구 사항을 수집
    - 수집한 요구 사항을 분석하여 그 결과를 요구 사항 명세서로 작성
2. 개념적 설계
    - 요구 사항 분석 단계에서 파악한 사용자의 요구 사항을 개념적 데이터 모델을 이용해 표현
    - 개념적 데이터 모델로 E-R모델을 많이 사용함
    - 요구 사항 명세서를 개념적 데이터 모델로 변환하는 일을 개념적 모델링이라 하고, E-R 다이어그램과 같이 개념적 데이터 모델로 표현한 결과물을 개념적 스키마라고 한다. 
3. 논리적 설계
    - 개발에 사용할 DBMS에 적합한 논리적 데이터 모델을 이용해 개념적 설계 단계에서 생성한 개념적 구조를 기반으로 논리적 구조를 설계
    - 일반적으로 관계 데이터 모델을 논리적 데이터 모델로 사용
    - E-R 다이어그램을 릴레이션 스키마로 변환하는 작업을 논리적 모델링이라 하고, 논리적 데이터 모델로 표현된 결과물을 논리적 스키마라고 한다. 
4. 물리적 설계
    - 저장 장치에 적합한 저장 레코드와 인덱스의 구조 등을 설계하고, 저장된 데이터와 인덱스에 빠르게 접근하게 할 수 있는 탐색 기법 등을 정의
    - 데이터베이스를 실제로 구축할 컴퓨터 시스템의 저장 장치와 운영체제의 특성을 고려하여, 효율적인 성능을 지원하면서도 사용할 DBMS로 구현이 가능한 물리적인 구조를 설계
    - 응답 시간을 최소화하고 저장 공간을 활용하면서 데이터베이스 시스템의 처리 능력을 향상시킬 수 있도록 물리적 구조를 설계
5. 구현
    - DBMS에서 SQL로 작성한 명령문을 실행하여 데이터베이스를 실제로 생성
    구현에서 사용되는 SQL 문은 테이블이나 인덱스 등을 생성할 때 사용되는 데이터 정의어(DDL)이다. 
- 모든 과정이 중요하지만, 특히 전체적인 데이터베이스의 개념적 구조와 논리적 구조를 설계하는 **요구 사항 분석**, **개념적 설계**, **논리적 설계**가 핵심 단계이다.

## 요구 사항 분석
- 먼저 데이터베이스를 사용할 주요 사용자의 범위부터 결정한다.
- 사용자의 범위가 결정되면 해당 사용자가 조직에서 수행하는 업무를 분석한다. 
- 요구 사항 분석이 잘못되면 사용자가 원치 않는 쓸모없는 데이터베이스가 개발되어, 고치거나 다시 개발해야 하기 때문에 어떤 단계보다도 신중하고 꼼꼼하게 작업을 수행해야 한다.

## 개념적 설계
### 개체와 속성 추출
- 개체는 현실 세계에서 어떤 조직을 운영하는 데 꼭 필요한 사람, 사물과 같이 구별되는 모든 것을 의미한다.
- 개체는 저장할 만한 가치가 있는 중요 데이터를 지닌 사람이나 사물 등이며, 개념적 모델링을 하는 데 가장 중요한 요소다.
- 개체를 추출할 때는 제시된 요구 사항의 문장들에서 명사부터 찾아야 한다. 단, 조직의 업무 처리와 관련이 적은 일반적이고 광범위한 의미의 명사는 제외한다. 그리고 의미가 같은 명사가 여러 개면 대표 명사 하나만 선택한다.
- 명사 중에는 개체가 아닌 속성으로 분류되는 단어도 존재하기 때문에 찾아낸 명사를 개체와 속성으로 정확히 분류하는 작업이 필요하다.
- 사용자가 만족하는 데이터베이스를 개발하려면 요구 사항 명세서의 요구 사항 문장에 있는 개체와 속성을 빠짐없이 추출해야 한다.
- E-R 다이어그램에서 개체는 사각형으로, 속성은 타원형으로 표현한다. 그리고 키 속성은 이름에 밑줄을 그어 표시한다. 
### 관계 추출
- 관계는 개체 간의 의미 있는 연관성이다. 일반적으로 관계는 요구 사항을 표현한 문장에서 동사로 표현된다.
- 조직의 업무 처리와 관련하여 개체 간의 연관성을 의미 있게 표현한 동사만 선택하고, 의미가 같은 동사가 여러 개이면 대표 동사 하나만 선택한다.
- 관계를 추출한 후에는 추출한 관계에 대한 매핑 카디널리티와 참여 특성을 결정한다.
- 매핑 카디널리티는 관계를 맺고 있는 두 개체에서, 각 개체 인스턴스가 관계를 맺고 있는 상대 개체의 개체 인스턴스 개수를 의미한다.
- 매핑 카디널리티를 기준으로 추출한 관계를 일대일, 일대다, 다대다 중 하나로 분류하고, 개체가 관계에 필수적으로 참여하고 있는지 선택적으로 참여하고 있는지를 의미하는 참여 특성을 결정한다.
- E-R 다이어그램에서 관계는 마름모료 표현하고, 사각형으로 표현된 개체와 선으로 연결한다. 그리고 일대일, 일대다, 다대다 관계는 선 위에 레이블로 표시한다. 필수적으로 참여하는 개체는 개체와 관계를 이중선으로 연결한다.

## 논리적 설계
### 릴레이션 스키마 변환 규칙
규칙1 : 모든 개체는 릴레이션으로 변환한다.  
- E-R 다이어그램의 각 개체를 하나의 릴레이션으로 변환한다. 개체의 이름을 릴레이션의 이름으로 하고, 개체가 가진 속성도 릴레이션의 속성으로 그대로 변환한다.  
- 개체가 가지고 있는 속성이 복합 속성인 경우에는 복합 속성을 구성하고 있는 단순 속성만 릴레이션의 속성으로 변환한다.  
- 개체가 가지고 있는 키 속성은 릴레이션의 기본키로 변환한다.  

규칙2 : 대다대 관계는 릴레이션으로 변환한다.  
- E-R 다이어그램에 있는 다대다 관계를 하나의 릴레이션으로 변환한다. 관계의 이름을 릴레이션의 이름으로 하고, 관계의 속성도 릴레이션의 속성으로 그대로 변환한다.  
- 관계를 맺고 있는 개체가 무엇인지 중요하므로, 관계를 맺고 있는 개체들을 규칙1에 따라 변환한 후 릴레이션들의 기본키를 관계 릴레이션에 포함시키고 외래기로 지정한다. 그리고 이 외래키들을 조합하여 관계 릴레이션의 기본키로 지정한다.  

규칙 3 : 일대다 관계는 외래키로 표현한다.  
- E-R 다이어그램에 있는 일대다 관계는 릴레이션으로 변환하지 않고 외래키로만 표현한다.  
- 약한 개체가 참여하는 일대다 관계는 일반 개체가 참여하는 경우와 다르게 처리해야 하므로 규칙3을 2개의 세부 규칙으로 나누어 적용한다.  

규칙 3-1 : 일반적인 일대다 관계는 외래키로 표현한다.  
- 일반 개체들이 참여하는 일대다 관계는 릴레이션으로 변환하지 않고 외래키로만 표현한다.  
- 일대다 관계에서 1측 개체 릴레이션의 기본키를 가져와 n측 개체 릴레이션에 포함시키고 외래키로 지정한다.  
- 관계의 속성들도 n측 개체 릴레이션에 포함시킨다. 단, 외래키나 관계의 속성을 포함시킬 때 해당 릴레이션의 원래 개체 속성과 이름이 같으면 이름을 변경해야 한다.  
- 만약 n측 개체 릴레이션의 기본키를 가져와 1측 개체 릴레이션에 외래키로 포함시키면 해당 외래키가 다중 값을 가져 릴레이션의 특성을 위반하므로 반드시 1측 개체 릴레이션의 기본키를 n측 개체 릴레이션의 외래키로 지정해야 한다.  

규칙 3-2 : 약한 개체가 참여하는 일대다 관계는 외래키를 포함해서 기본키로 지정한다.  
- 약한 개체가 참여하는 일대다 관계도 릴레이션으로 변환하지 않고 외래키로만 표현한다.  
- 일반 개체들이 참여하는 일대다 관계와 다른 점은, 외래키가 포함된 릴레이션에서 이 외래키를 포함하여 기본키를 지정해야 한다는 것이다. 즉, n측 개체 릴레이션이 가지고 있던 키속성과 외래키 속성을 조합하여 기본키로 지정한다.  

규칙 4 : 일대일 관계는 외래키로 표현한다.  
- E-R 다이어그램에 있는 일대일 관계도 일대다 관계처럼 릴레이션으로 변환하지 않고 외래키로만 표현한다.  
- 데이터의 중복을 피하려면 개체가 관계에 참여하는 특성에 따라 약간 다르게 처리해야 하므로 3개의 세부 규칙으로 나누어 적용한다.  

규칙 4-1 : 일반적인 일대일 관계는 외래키를 서로 주고받는다.  
- 일반적인 일대일 관계는 릴레이션으로 변환하지 않고 외래키로만 표현한다.  
- 관계를 맺는 개체들을 규칙1에 따라 변환한 릴레이션들이 서로의 기본키를 주고받아 이를 외래키로 지정한다. 이때, 관계가 가지는 속성들은 관계에 참여하는 개체를 변환한 릴레이션에 모두 포함시킨다.  

규칙 4-2 : 일대일 관계에 필수적으로 참여하는 개체의 릴레이션만 외래키를 받는다.  
- 일대일 관계를 맺고 있는 두 개체 중 관계에 필수적으로 참여하는 개체에 대응하는 릴레이션에만 외래키를 포함시킨다.  
- 관계에 필수적으로 참여하는 개체에 해당하는 릴레이션이 선택적으로 참여하는 개체에 해당하는 릴레이션의 기본키를 받아 외래키로 지정한다. 이때, 관계가 가지고 있는 속성들도 관계에 필수적으로 참여하는 개체에 해당하는 릴레이션에 함께 포함시킨다.  

규칙 4-3 : 모든 개체가 일대일 관계에 필수적으로 참여하면 릴레이션 하나로 합친다.  
- 일대일 관계를 맺고 있는 두 개체가 모두 관계에 필수적으로 참여한다면 그만큼 관련성이 있는 개체라는 의미다. 그러므로 두 개체에 해당하는 두 릴레이션을 하나로 합쳐 표현한다.  
- 관계의 이름을 릴레이션의 이름으로 사용하고, 관계에 참여하는 두 개체의 속성들도 관계 릴레이션에 모두 포함시킨다. 그리고 두 개체 릴레이션의 키 속성을 조합하여 관계 릴레이션의 기본키로 지정한다.  

규칙 5 : 다중 값 속성은 릴레이션으로 변환한다.  
- 관계 데이터 모델의 릴레이션에서는 다중 값을 가지는 속성을 허용하지 않는다. 그러므로 E-R 다이어그램에 있는 다중 값 속성은 그 속성을 가지고 있는 개체에 해당하는 릴레이션이 아닌 별도의 릴레이션을 만들어 포함시킨다.  

## 물리적 설계와 구현
- 물리적 설계 단계에서는 하드웨어나 운영체제의 특성을 고려하여 필요한 인덱스의 구조나 내부 저장 구조 등에 대한 물리적인 구조를 설계한다.  
- 마지막으로 DBMS를 이용해 SQL문을 작성하고 이를 실행시켜서 데이터베이스를 실제로 생성하면 데이터베이스 개발이 완료된다.